enno-auto-post
==============

PHP script to send blogpost via XML-RPC. Supported by Byword (for writing in Markdown) and Keyboard Maestro (for doing all the magic).

Intro
-----

This script is made to process HTML output generated by the most recent version of [Byword](http://bywordapp.com/ "Byword • A Simple Text Editor for Mac and iOS"), my favorite OS X distraction free text editor. When you're done writing a blogpost, you can use [Keyboard Maestro](http://www.keyboardmaestro.com/ "Keyboard Maestro 5.3.2: Work Faster with Macros for Mac OS X") to send it to your WordPress installation as a new draft.

It will take care of all the annoying stuff you'd normally be forced to do by hand like

- uploading images,
- setting tags and categories and
- writing an abstract.

How to use
----------

1. Write your blogpost. Be sure to use a file header like this:

```
@slug: this-is-my-slug
@tags: Just, A, Few, Tags
@categories: My Category One, My Category Two
@excerpt: This is my excerpt where I sum up the article's major points.

# My Blogpost's Headline
```

2. Once you are done writing your blogpost, press ⌥⌘C in Byword in order to generate HTML and automatically copy the result to your clipboard.
3. Use Keyboard Maestro's menu bar item to trigger *Send Blogpost to iEnno* (you probably want to rename this to fit your own blog's name).
4. Wait while your HTML is processed and uploaded to WordPress.
5. Once it's done the script will automatically open the newly saved article in the WordPress Editor in your default browser.

Setup
-----

### *config.ini*

First you need the fill the configuration file in `inc/config.ini` to suite your blog. An example looks like this:

	[senaeh]
	url = 'http://www.senaeh.de'
	user = 'username'
	pass = 'ç00l p@$$wø®d'
	max_width = 520
	max_height = 700
	
	[ienno]
	url = 'http://www.ienno.de',
	user = 'username2'
	pass = '@nø†h€® p@$$wø®d'
	max_width =  530
	max_height = 530

You are allowed to insert multiple blogs in here. Make sure each of them has a section name (like `[ienno]` and `[senaeh]` in the example above.)

`url`, `user` and `pass` should be a no brainer. `max_width` and `max_height` refers to the maximum dimension of your medium size images as you can find via *Settings* → *Media* in your WordPress backend.

![Media Settings](https://raw.github.com/LeEnno/enno-auto-post/master/screenshot_media_settings.png)

I might tweak this in the future so these settings will be read via XML-RPC automatically. But for now you just have to copy and paste those values into the config file.

### Path to PHP script

Look into the Keyboard Maestro (KM) macro. Go to the group *EnnoAutoPost* and look for the *Send Blogpost to WP* macro. The second action calls the PHP script. You have to adjust the path where it's located. Currently it's set to `/Users/Enno/Sites/xmlrpc/index.php`.

![Path to PHP Script](https://raw.github.com/LeEnno/enno-auto-post/master/screenshot_php_path.png)

### Blog Identifier

Remember those sections names from the `config.ini`? We need to pouplate them into the corresponding macros. Look for *Send Blogpost to iEnno* and rename it so it fits you blog's name. Look at the first action (*Set Variable 'blogIdentifier' to Text 'ienno'*) and insert the section name from the `config.ini`. This will ensure the PHP script reads the correct credentials etc.

![Adjust blogIdentifier](https://raw.github.com/LeEnno/enno-auto-post/master/screenshot_blogIdentifier.png)

How it works
------------

If you understand German, you may want to read [this series of articles](http://www.senaeh.de/seriesenaeh/effizienteres-bloggen-mit-wordpress-dank-xml-rpc/ "Series: Effizienteres Bloggen mit WordPress dank XML-RPC « senäh") I wrote.

For the rest of you here's a little summary.

### Setting Variables and Calling the PHP Script

Once the generated HTML output is copied to clipboard and the Keyboard Maestro (KM) macro is triggered, KM will call the `index.php`.

The `blogIdentifier` variable in KM will be used in the PHP script to determine which config (URL, username, password) to use. The config data can be found in `inc/config.ini`.

### Processing HTML and sending it to WordPress

Within the PHP script a few things happen. First off the header as described in *How to Use* will be parsed and saved into variables for later access.

Next up it will correct the generated HTML for code blocks. Byword wraps code with `<pre><code>some code</code></pre>`. The `<code>`-Tag unfortunately breaks the preformatting, so we just replace it with `<pre>`.

Afterwards the script searches for image markup and uploads them. The script assumes the images has a `src`- and an `alt`-attribute. The `title`-attribute is optional and will be ignored, even if it's provided. It's good practice to provide an `alt`-attribute, so this is used as the image's title, caption and description (as seen in WordPress Media Library).

Finally the script will upload the post to WordPress.

### Opening URL in Chrome

After uploading the post via XML-RPC the script receives the newly saved post's ID. It builds up the URL for viewing the draft in the WordPress backend and returns it to the shell script, so it will be opened it in your default browser.

Now you can check if everything worked fine and finally publish your post.

Dependancies and Limitations
----------------------------

### Absolute Path for Images

Be sure to link to your images with absolute paths. Otherwise the script won't be able to find them and the script will stop execution.

### If you don't want to use Byword or Keyboard Maestro

Instead of Byword and Keyboard Maestro feel free to use every appropriate application you want to. You just have to use something that

1. is able to generate HTML output and
2. is able to execute a bash command.

If you know a little PHP you should easily be able to adapt it to your needs. If you need help you may ask me ;)

### Compatibility

**Notice that it's currently not tested in WordPress version 3.5.** Hopefully I'll get to this within the next few weeks.

---

If you got any questions or issues let me know: enricoschlag at gmail dot com